<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>Reset Password</title>
</head>
<body>
<section>
	<div class="container-fluid min-vh-100 d-flex align-items-center py-5">
		<div class="container">
			<div class="row justify-content-center g-5">

				<!-- Illustration Side -->
				<div class="col-lg-6 d-none d-lg-flex align-items-center justify-content-center">
					<div class="illustration-container">
						<div class="floating-shapes">
							<div class="shape shape-1"></div>
							<div class="shape shape-2"></div>
							<div class="shape shape-3"></div>
						</div>
						<div class="illustration-content text-center">
							<div class="lock-icon mb-4">
								<i class="fas fa-lock"></i>
							</div>
							<h2 class="fw-bold mb-3 text-white">Secure Password Reset</h2>
							<p class="text-white-50 lead">
								Create a strong password to protect your account
							</p>
							<div class="security-badges mt-4">
								<div class="badge-item">
									<i class="fas fa-shield-alt"></i>
									<span>Encrypted</span>
								</div>
								<div class="badge-item">
									<i class="fas fa-lock"></i>
									<span>Secure</span>
								</div>
								<div class="badge-item">
									<i class="fas fa-check-circle"></i>
									<span>Protected</span>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Form Side -->
				<div class="col-lg-6 col-md-8">
					<div class="card border-0 shadow-lg rounded-4 overflow-hidden">

						<!-- Card Header -->
						<div class="card-header text-white text-center py-4 border-0"
							 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
							<div class="header-icon mb-3">
								<i class="fas fa-key"></i>
							</div>
							<h4 class="mb-1 fw-bold">Reset Your Password</h4>
							<p class="mb-0 text-white-50">Enter your new password below</p>
						</div>

						<div class="card-body p-4 p-md-5">

							<!-- Success/Error Messages -->
							<th:block th:if="${session.succMsg}">
								<div class="alert alert-success alert-dismissible fade show border-0 shadow-sm rounded-3 mb-4" role="alert">
									<div class="d-flex align-items-center">
										<i class="fas fa-check-circle fs-4 me-3"></i>
										<div>
											<strong>Success!</strong>
											<p class="mb-0">[[${session.succMsg}]]</p>
										</div>
									</div>
									<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
									<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
								</div>
							</th:block>

							<th:block th:if="${session.errorMsg}">
								<div class="alert alert-danger alert-dismissible fade show border-0 shadow-sm rounded-3 mb-4" role="alert">
									<div class="d-flex align-items-center">
										<i class="fas fa-exclamation-circle fs-4 me-3"></i>
										<div>
											<strong>Error!</strong>
											<p class="mb-0">[[${session.errorMsg}]]</p>
										</div>
									</div>
									<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
									<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
								</div>
							</th:block>

							<!-- Password Requirements Info -->
							<div class="alert alert-light border rounded-3 mb-4">
								<div class="d-flex align-items-start">
									<i class="fas fa-info-circle text-primary fs-5 me-3 mt-1"></i>
									<div>
										<strong>Password Requirements:</strong>
										<ul class="mb-0 mt-2 ps-3 small" id="passwordRequirements">
											<li id="req-length" class="text-muted">
												<i class="fas fa-circle-notch me-1"></i>At least 8 characters
											</li>
											<li id="req-uppercase" class="text-muted">
												<i class="fas fa-circle-notch me-1"></i>One uppercase letter
											</li>
											<li id="req-lowercase" class="text-muted">
												<i class="fas fa-circle-notch me-1"></i>One lowercase letter
											</li>
											<li id="req-number" class="text-muted">
												<i class="fas fa-circle-notch me-1"></i>One number
											</li>
										</ul>
									</div>
								</div>
							</div>

							<!-- Reset Password Form -->
							<form action="/reset-password" method="post" id="resetPassword" novalidate>

								<!-- New Password -->
								<div class="mb-4">
									<label class="form-label fw-semibold text-muted">
										<i class="fas fa-lock text-primary me-2"></i>New Password
									</label>
									<div class="input-group input-group-lg">
                                            <span class="input-group-text bg-light border-end-0 rounded-start-3">
                                                <i class="fas fa-key text-muted"></i>
                                            </span>
										<input id="password"
											   class="form-control border-start-0 border-end-0"
											   name="password"
											   type="password"
											   placeholder="Enter new password"
											   required>
										<button class="btn btn-outline-secondary rounded-end-3 border-start-0"
												type="button"
												onclick="togglePasswordVisibility('password', this)">
											<i class="fas fa-eye"></i>
										</button>
									</div>
									<!-- Password Strength Indicator -->
									<div class="password-strength mt-2">
										<div class="strength-bar">
											<div id="strengthBar" class="strength-fill"></div>
										</div>
										<small id="strengthText" class="text-muted">Password strength: <span>Not set</span></small>
									</div>
								</div>

								<!-- Confirm Password -->
								<div class="mb-4">
									<label class="form-label fw-semibold text-muted">
										<i class="fas fa-check-circle text-success me-2"></i>Confirm Password
									</label>
									<div class="input-group input-group-lg">
                                            <span class="input-group-text bg-light border-end-0 rounded-start-3">
                                                <i class="fas fa-lock text-muted"></i>
                                            </span>
										<input id="confirmPassword"
											   name="confirmPassword"
											   class="form-control border-start-0 border-end-0"
											   type="password"
											   placeholder="Confirm new password"
											   required>
										<button class="btn btn-outline-secondary rounded-end-3 border-start-0"
												type="button"
												onclick="togglePasswordVisibility('confirmPassword', this)">
											<i class="fas fa-eye"></i>
										</button>
									</div>
									<small id="passwordMatch" class="text-muted"></small>
								</div>

								<!-- Hidden Token -->
								<input type="hidden" th:value="${token}" name="token">

								<!-- Submit Button -->
								<button type="submit" class="btn btn-primary btn-lg w-100 rounded-3 shadow-sm mt-3">
									<i class="fas fa-shield-alt me-2"></i>Reset Password
								</button>

							</form>

							<!-- Back to Login -->
							<div class="text-center mt-4">
								<a href="/signin" class="text-decoration-none">
									<i class="fas fa-arrow-left me-1"></i>
									Back to Login
								</a>
							</div>

						</div>
					</div>

					<!-- Help Card -->
					<div class="card border-0 shadow-sm rounded-3 mt-3">
						<div class="card-body p-3 text-center">
							<small class="text-muted">
								<i class="fas fa-question-circle me-1"></i>
								Need help? <a href="#" class="text-decoration-none">Contact Support</a>
							</small>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>

	<!-- Custom Styles -->
	<style>
		/* Illustration Side */
        .illustration-container {
            position: relative;
            padding: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2rem;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: 2rem;
        }

        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }

        .shape-1 {
            width: 150px;
            height: 150px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 100px;
            height: 100px;
            bottom: 20%;
            right: 15%;
            animation-delay: 3s;
        }

        .shape-3 {
            width: 80px;
            height: 80px;
            top: 50%;
            right: 10%;
            animation-delay: 6s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-30px) rotate(180deg);
            }
        }

        .illustration-content {
            position: relative;
            z-index: 1;
        }

        .lock-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            animation: pulse 2s infinite;
        }

        .lock-icon i {
            font-size: 3rem;
            color: white;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .security-badges {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .badge-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            backdrop-filter: blur(10px);
        }

        .badge-item i {
            font-size: 1.25rem;
        }

        /* Header Icon */
        .header-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .header-icon i {
            font-size: 2rem;
            color: white;
        }

        /* Password Strength */
        .password-strength {
            margin-top: 0.5rem;
        }

        .strength-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .strength-fill {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: 10px;
        }

        .strength-weak {
            width: 33%;
            background: #dc3545;
        }

        .strength-medium {
            width: 66%;
            background: #ffc107;
        }

        .strength-strong {
            width: 100%;
            background: #28a745;
        }

        /* Password Requirements */
        #passwordRequirements li.met {
            color: #28a745 !important;
        }

        #passwordRequirements li.met i {
            color: #28a745;
        }

        /* Form Styles */
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .rounded-4 {
            border-radius: 1rem !important;
        }

        .input-group:focus-within .input-group-text {
            border-color: #667eea;
            background-color: #f8f9ff;
        }

        @media (max-width: 992px) {
            .min-vh-100 {
                min-height: auto;
            }
        }
	</style>

	<!-- Password Validation Script -->
	<script>
		// Toggle password visibility
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const form = document.getElementById('resetPassword');
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            const passwordMatch = document.getElementById('passwordMatch');

            // Password strength checker
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;

                // Check requirements
                const hasLength = password.length >= 8;
                const hasUppercase = /[A-Z]/.test(password);
                const hasLowercase = /[a-z]/.test(password);
                const hasNumber = /[0-9]/.test(password);

                // Update requirement indicators
                updateRequirement('req-length', hasLength);
                updateRequirement('req-uppercase', hasUppercase);
                updateRequirement('req-lowercase', hasLowercase);
                updateRequirement('req-number', hasNumber);

                // Calculate strength
                if (hasLength) strength++;
                if (hasUppercase) strength++;
                if (hasLowercase) strength++;
                if (hasNumber) strength++;

                // Update strength bar
                strengthBar.className = 'strength-fill';
                if (strength === 1 || strength === 2) {
                    strengthBar.classList.add('strength-weak');
                    strengthText.innerHTML = 'Password strength: <span class="text-danger">Weak</span>';
                } else if (strength === 3) {
                    strengthBar.classList.add('strength-medium');
                    strengthText.innerHTML = 'Password strength: <span class="text-warning">Medium</span>';
                } else if (strength === 4) {
                    strengthBar.classList.add('strength-strong');
                    strengthText.innerHTML = 'Password strength: <span class="text-success">Strong</span>';
                } else {
                    strengthText.innerHTML = 'Password strength: <span class="text-muted">Not set</span>';
                }

                checkPasswordMatch();
            });

            // Check password match
            confirmPasswordInput.addEventListener('input', checkPasswordMatch);

            function checkPasswordMatch() {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                if (confirmPassword.length > 0) {
                    if (password === confirmPassword) {
                        passwordMatch.innerHTML = '<i class="fas fa-check-circle text-success me-1"></i>Passwords match';
                        passwordMatch.className = 'text-success small';
                    } else {
                        passwordMatch.innerHTML = '<i class="fas fa-times-circle text-danger me-1"></i>Passwords do not match';
                        passwordMatch.className = 'text-danger small';
                    }
                } else {
                    passwordMatch.innerHTML = '';
                }
            }

            function updateRequirement(id, met) {
                const element = document.getElementById(id);
                if (met) {
                    element.classList.add('met');
                    element.querySelector('i').className = 'fas fa-check-circle me-1';
                } else {
                    element.classList.remove('met');
                    element.querySelector('i').className = 'fas fa-circle-notch me-1';
                }
            }

            // Form validation
            form.addEventListener('submit', function(e) {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                // Check all requirements
                const hasLength = password.length >= 8;
                const hasUppercase = /[A-Z]/.test(password);
                const hasLowercase = /[a-z]/.test(password);
                const hasNumber = /[0-9]/.test(password);

                if (!hasLength || !hasUppercase || !hasLowercase || !hasNumber) {
                    e.preventDefault();
                    alert('Please meet all password requirements');
                    return false;
                }

                if (password !== confirmPassword) {
                    e.preventDefault();
                    alert('Passwords do not match!');
                    return false;
                }
            });
        });
	</script>

</section>
</body>
</html>