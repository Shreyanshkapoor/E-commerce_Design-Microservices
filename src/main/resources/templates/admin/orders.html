<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>Order Management</title>
</head>
<body>
<section>
	<div class="container-fluid mt-4 px-3 px-md-5 py-4">

		<!-- Page Header -->
		<div class="row mb-4">
			<div class="col-12">
				<div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3">
					<div>
						<h2 class="fw-bold mb-2">
							<i class="fas fa-shopping-bag text-primary me-2"></i>Order Management
						</h2>
						<p class="text-muted mb-0">Track and manage all customer orders</p>
					</div>
					<div class="d-flex gap-2">
						<a href="/admin/" class="btn btn-outline-secondary rounded-pill px-4">
							<i class="fas fa-arrow-left me-2"></i>Back to Dashboard
						</a>
						<button class="btn btn-success rounded-pill px-4">
							<i class="fas fa-file-excel me-2"></i>Export Orders
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Success/Error Messages -->
		<div class="row">
			<div class="col-12">
				<th:block th:if="${session.succMsg}">
					<div class="alert alert-success alert-dismissible fade show border-0 shadow-sm rounded-3 mb-4" role="alert">
						<div class="d-flex align-items-center">
							<i class="fas fa-check-circle fs-4 me-3"></i>
							<div>
								<strong>Success!</strong>
								<p class="mb-0">[[${session.succMsg}]]</p>
							</div>
						</div>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
					</div>
				</th:block>

				<th:block th:if="${session.errorMsg}">
					<div class="alert alert-danger alert-dismissible fade show border-0 shadow-sm rounded-3 mb-4" role="alert">
						<div class="d-flex align-items-center">
							<i class="fas fa-exclamation-circle fs-4 me-3"></i>
							<div>
								<strong>Error!</strong>
								<p class="mb-0">[[${session.errorMsg}]]</p>
							</div>
						</div>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
					</div>
				</th:block>
			</div>
		</div>

		<!-- Search Section -->
		<div class="row mb-4">
			<div class="col-12">
				<div class="card border-0 shadow-sm rounded-3">
					<div class="card-body p-4">
						<form action="/admin/search-order" method="get">
							<div class="row g-3 align-items-center">
								<div class="col-md-8">
									<div class="input-group input-group-lg">
											<span class="input-group-text bg-light border-end-0 rounded-start-3">
												<i class="fas fa-search text-muted"></i>
											</span>
										<input type="text"
											   class="form-control border-start-0 ps-0"
											   name="orderId"
											   placeholder="Search by Order ID (e.g., ORD-12345)"
											   style="box-shadow: none;">
									</div>
								</div>
								<div class="col-md-4">
									<button type="submit" class="btn btn-primary btn-lg w-100 rounded-3">
										<i class="fas fa-search me-2"></i>Search Order
									</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- Orders Table Card -->
		<div class="row">
			<div class="col-12">
				<div class="card border-0 shadow-lg rounded-4 overflow-hidden">

					<!-- Card Header -->
					<div class="card-header text-white py-4 border-0"
						 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
						<div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
							<div>
								<h5 class="mb-0 fw-bold">
									<i class="fas fa-list-ul me-2"></i>
									<span th:if="${srch}">Search Results</span>
									<span th:unless="${srch}">All Orders</span>
								</h5>
							</div>
							<div th:unless="${srch}">
									<span class="badge bg-white text-primary px-3 py-2 fs-6">
										Total: <span th:text="${totalElements}">0</span> Orders
									</span>
							</div>
						</div>
					</div>

					<!-- Table Section -->
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
								<tr>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-hashtag me-2"></i>Order ID
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-user me-2"></i>Customer Details
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-calendar me-2"></i>Date
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-box me-2"></i>Product
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-rupee-sign me-2"></i>Price Details
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted text-center">
										<i class="fas fa-info-circle me-2"></i>Status
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted text-center">
										<i class="fas fa-cog me-2"></i>Action
									</th>
								</tr>
								</thead>
								<tbody>
								<!-- Search Result -->
								<th:block th:if="${srch}">
									<th:block th:if="${orderDtls!=null}">
										<tr class="border-bottom">
											<th scope="row" class="py-4 px-4">
														<span class="badge bg-primary bg-gradient px-3 py-2 fs-6">
															[[${orderDtls.orderId}]]
														</span>
											</th>
											<td class="py-4 px-4">
												<div class="customer-info">
													<div class="mb-2">
														<i class="fas fa-user text-primary me-2"></i>
														<strong>[[${orderDtls.orderAddress.firstName}]] [[${orderDtls.orderAddress.lastName}]]</strong>
													</div>
													<div class="mb-1 text-muted small">
														<i class="fas fa-envelope me-2"></i>[[${orderDtls.orderAddress.email}]]
													</div>
													<div class="mb-1 text-muted small">
														<i class="fas fa-phone me-2"></i>[[${orderDtls.orderAddress.mobileNo}]]
													</div>
													<div class="text-muted small">
														<i class="fas fa-map-marker-alt me-2"></i>
														[[${orderDtls.orderAddress.address}]],
														[[${orderDtls.orderAddress.city}]],
														[[${orderDtls.orderAddress.state}]] -
														[[${orderDtls.orderAddress.pincode}]]
													</div>
												</div>
											</td>
											<td class="py-4 px-4">
												<div class="text-muted">
													<i class="fas fa-calendar-alt text-info me-2"></i>
													[[${orderDtls.orderDate}]]
												</div>
											</td>
											<td class="py-4 px-4">
												<div class="fw-semibold text-dark">
													[[${orderDtls.product.title}]]
												</div>
											</td>
											<td class="py-4 px-4">
												<div class="price-details">
													<div class="mb-1">
																<span class="badge bg-light text-dark border px-2 py-1">
																	<i class="fas fa-cubes me-1"></i>Qty: [[${orderDtls.quantity}]]
																</span>
													</div>
													<div class="mb-1 text-muted small">
														Unit Price: ₹[[${orderDtls.price}]]
													</div>
													<div class="fw-bold text-success fs-6">
														Total: ₹[[${orderDtls.quantity * orderDtls.price}]]
													</div>
												</div>
											</td>
											<td class="py-4 px-4 text-center">
														<span th:if="${orderDtls.status == 'In Progress'}"
															  class="badge bg-info bg-gradient px-3 py-2 rounded-pill">
															<i class="fas fa-spinner me-1"></i>[[${orderDtls.status}]]
														</span>
												<span th:if="${orderDtls.status == 'Order Received'}"
													  class="badge bg-primary bg-gradient px-3 py-2 rounded-pill">
															<i class="fas fa-check me-1"></i>[[${orderDtls.status}]]
														</span>
												<span th:if="${orderDtls.status == 'Product Packed'}"
													  class="badge bg-warning bg-gradient px-3 py-2 rounded-pill">
															<i class="fas fa-box me-1"></i>[[${orderDtls.status}]]
														</span>
												<span th:if="${orderDtls.status == 'Out for Delivery'}"
													  class="badge bg-secondary bg-gradient px-3 py-2 rounded-pill">
															<i class="fas fa-truck me-1"></i>[[${orderDtls.status}]]
														</span>
												<span th:if="${orderDtls.status == 'Delivered'}"
													  class="badge bg-success bg-gradient px-3 py-2 rounded-pill">
															<i class="fas fa-check-circle me-1"></i>[[${orderDtls.status}]]
														</span>
												<span th:if="${orderDtls.status == 'Cancelled'}"
													  class="badge bg-danger bg-gradient px-3 py-2 rounded-pill">
															<i class="fas fa-times-circle me-1"></i>[[${orderDtls.status}]]
														</span>
											</td>
											<td class="py-4 px-4">
												<form action="/admin/update-order-status" method="post">
													<div class="d-flex flex-column gap-2">
														<select class="form-select form-select-sm rounded-3" name="st">
															<option>-- Select Status --</option>
															<option value="1">In Progress</option>
															<option value="2">Order Received</option>
															<option value="3">Product Packed</option>
															<option value="4">Out for Delivery</option>
															<option value="5">Delivered</option>
															<option value="6">Cancelled</option>
														</select>
														<input th:value="${orderDtls.id}" name="id" type="hidden">
														<th:block th:if="${orderDtls.status=='Cancelled' || orderDtls.status=='Delivered'}">
															<button class="btn btn-sm btn-secondary rounded-3 disabled w-100">
																<i class="fas fa-lock me-1"></i>Locked
															</button>
														</th:block>
														<th:block th:unless="${orderDtls.status=='Cancelled' || orderDtls.status=='Delivered'}">
															<button class="btn btn-sm btn-primary rounded-3 w-100">
																<i class="fas fa-sync-alt me-1"></i>Update
															</button>
														</th:block>
													</div>
												</form>
											</td>
										</tr>
									</th:block>
									<th:block th:unless="${orderDtls!=null}">
										<tr>
											<td colspan="7" class="text-center py-5">
												<div class="py-5">
													<i class="fas fa-search text-danger mb-3" style="font-size: 4rem; opacity: 0.3;"></i>
													<h5 class="text-danger">[[${errorMsg}]]</h5>
													<p class="text-muted">No order found with the given Order ID</p>
												</div>
											</td>
										</tr>
									</th:block>
								</th:block>

								<!-- All Orders List -->
								<th:block th:unless="${srch}">
									<tr th:each="o:${orders}" class="border-bottom">
										<th scope="row" class="py-4 px-4">
													<span class="badge bg-primary bg-gradient px-3 py-2 fs-6">
														[[${o.orderId}]]
													</span>
										</th>
										<td class="py-4 px-4">
											<div class="customer-info">
												<div class="mb-2">
													<i class="fas fa-user text-primary me-2"></i>
													<strong>[[${o.orderAddress.firstName}]] [[${o.orderAddress.lastName}]]</strong>
												</div>
												<div class="mb-1 text-muted small">
													<i class="fas fa-envelope me-2"></i>[[${o.orderAddress.email}]]
												</div>
												<div class="mb-1 text-muted small">
													<i class="fas fa-phone me-2"></i>[[${o.orderAddress.mobileNo}]]
												</div>
												<div class="text-muted small">
													<i class="fas fa-map-marker-alt me-2"></i>
													[[${o.orderAddress.address}]],
													[[${o.orderAddress.city}]],
													[[${o.orderAddress.state}]] -
													[[${o.orderAddress.pincode}]]
												</div>
											</div>
										</td>
										<td class="py-4 px-4">
											<div class="text-muted">
												<i class="fas fa-calendar-alt text-info me-2"></i>
												[[${o.orderDate}]]
											</div>
										</td>
										<td class="py-4 px-4">
											<div class="fw-semibold text-dark">
												[[${o.product.title}]]
											</div>
										</td>
										<td class="py-4 px-4">
											<div class="price-details">
												<div class="mb-1">
															<span class="badge bg-light text-dark border px-2 py-1">
																<i class="fas fa-cubes me-1"></i>Qty: [[${o.quantity}]]
															</span>
												</div>
												<div class="mb-1 text-muted small">
													Unit Price: ₹[[${o.price}]]
												</div>
												<div class="fw-bold text-success fs-6">
													Total: ₹[[${o.quantity * o.price}]]
												</div>
											</div>
										</td>
										<td class="py-4 px-4 text-center">
													<span th:if="${o.status == 'In Progress'}"
														  class="badge bg-info bg-gradient px-3 py-2 rounded-pill">
														<i class="fas fa-spinner me-1"></i>[[${o.status}]]
													</span>
											<span th:if="${o.status == 'Order Received'}"
												  class="badge bg-primary bg-gradient px-3 py-2 rounded-pill">
														<i class="fas fa-check me-1"></i>[[${o.status}]]
													</span>
											<span th:if="${o.status == 'Product Packed'}"
												  class="badge bg-warning bg-gradient px-3 py-2 rounded-pill">
														<i class="fas fa-box me-1"></i>[[${o.status}]]
													</span>
											<span th:if="${o.status == 'Out for Delivery'}"
												  class="badge bg-secondary bg-gradient px-3 py-2 rounded-pill">
														<i class="fas fa-truck me-1"></i>[[${o.status}]]
													</span>
											<span th:if="${o.status == 'Delivered'}"
												  class="badge bg-success bg-gradient px-3 py-2 rounded-pill">
														<i class="fas fa-check-circle me-1"></i>[[${o.status}]]
													</span>
											<span th:if="${o.status == 'Cancelled'}"
												  class="badge bg-danger bg-gradient px-3 py-2 rounded-pill">
														<i class="fas fa-times-circle me-1"></i>[[${o.status}]]
													</span>
										</td>
										<td class="py-4 px-4">
											<form action="/admin/update-order-status" method="post">
												<div class="d-flex flex-column gap-2">
													<select class="form-select form-select-sm rounded-3" name="st">
														<option>-- Select Status --</option>
														<option value="1">In Progress</option>
														<option value="2">Order Received</option>
														<option value="3">Product Packed</option>
														<option value="4">Out for Delivery</option>
														<option value="5">Delivered</option>
														<option value="6">Cancelled</option>
													</select>
													<input th:value="${o.id}" name="id" type="hidden">
													<th:block th:if="${o.status=='Cancelled' || o.status=='Delivered'}">
														<button class="btn btn-sm btn-secondary rounded-3 disabled w-100">
															<i class="fas fa-lock me-1"></i>Locked
														</button>
													</th:block>
													<th:block th:unless="${o.status=='Cancelled' || o.status=='Delivered'}">
														<button class="btn btn-sm btn-primary rounded-3 w-100">
															<i class="fas fa-sync-alt me-1"></i>Update
														</button>
													</th:block>
												</div>
											</form>
										</td>
									</tr>

									<!-- Empty State -->
									<tr th:if="${orders.isEmpty()}">
										<td colspan="7" class="text-center py-5">
											<div class="py-5">
												<i class="fas fa-shopping-bag text-muted mb-3" style="font-size: 4rem; opacity: 0.3;"></i>
												<h5 class="text-muted">No Orders Found</h5>
												<p class="text-muted mb-0">There are currently no orders in the system.</p>
											</div>
										</td>
									</tr>
								</th:block>
								</tbody>
							</table>
						</div>
					</div>

					<!-- Pagination Footer -->
					<th:block th:if="${!srch}">
						<div class="card-footer bg-light border-0 py-4">
							<div class="row align-items-center g-3">
								<div class="col-md-4">
									<div class="d-flex align-items-center gap-2">
										<i class="fas fa-info-circle text-primary"></i>
										<span class="text-muted">
												Showing <span class="fw-bold text-dark" th:text="${orders.size()}">0</span>
												of <span class="fw-bold text-dark" th:text="${totalElements}">0</span> orders
											</span>
									</div>
								</div>
								<div class="col-md-8">
									<nav aria-label="Order pagination">
										<ul class="pagination pagination-lg justify-content-end mb-0">
											<li class="page-item" th:classappend="${isFirst} ? 'disabled':''">
												<a class="page-link rounded-start-3"
												   th:href="@{'/admin/orders?pageNo='+${pageNo-1}}"
												   aria-label="Previous">
													<i class="fas fa-chevron-left"></i>
													<span class="d-none d-md-inline ms-2">Previous</span>
												</a>
											</li>

											<li th:each="i:${#numbers.sequence(1,totalPages)}"
												class="page-item"
												th:classappend="${pageNo+1==i}?'active':''">
												<a class="page-link"
												   th:href="@{'/admin/orders?pageNo='+${i-1}}">[[${i}]]</a>
											</li>

											<li class="page-item" th:classappend="${isLast} ? 'disabled':''">
												<a class="page-link rounded-end-3"
												   th:href="@{'/admin/orders?pageNo='+${pageNo+1}}"
												   aria-label="Next">
													<span class="d-none d-md-inline me-2">Next</span>
													<i class="fas fa-chevron-right"></i>
												</a>
											</li>
										</ul>
									</nav>
								</div>
							</div>
						</div>
					</th:block>

				</div>
			</div>
		</div>

	</div>

	<!-- Custom Styles -->
	<style>
		.table tbody tr {
            transition: all 0.3s ease;
        }

        .table tbody tr:hover {
            background-color: #f8f9ff;
            transform: scale(1.005);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .customer-info {
            max-width: 300px;
        }

        .price-details {
            min-width: 150px;
        }

        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .rounded-4 {
            border-radius: 1rem !important;
        }

        .pagination .page-link {
            border: none;
            margin: 0 3px;
            border-radius: 8px;
            padding: 10px 16px;
            transition: all 0.3s ease;
        }

        .pagination .page-item.active .page-link {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .pagination .page-link:hover:not(.active) {
            background-color: #f8f9ff;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(56, 239, 125, 0.3);
        }

        .input-group:focus-within .input-group-text {
            border-color: #667eea;
            background-color: #f8f9ff;
        }

        .input-group:focus-within .form-control {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
        }

        @media (max-width: 768px) {
            .table {
                font-size: 0.875rem;
            }

            .customer-info {
                max-width: 200px;
            }
        }
	</style>

</section>
</body>
</html>