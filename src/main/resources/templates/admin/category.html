<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>Category Management</title>
</head>
<body>
<section>
	<div class="container-fluid mt-4 px-3 px-md-5 py-4">

		<!-- Page Header -->
		<div class="row mb-4">
			<div class="col-12">
				<div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
					<div>
						<h2 class="fw-bold mb-2">
							<i class="fas fa-layer-group text-primary me-2"></i>Category Management
						</h2>
						<p class="text-muted mb-0">Organize and manage product categories</p>
					</div>
					<div>
						<a href="/admin/" class="btn btn-outline-secondary rounded-pill px-4">
							<i class="fas fa-arrow-left me-2"></i>Back to Dashboard
						</a>
					</div>
				</div>
			</div>
		</div>

		<div class="row g-4">

			<!-- Add Category Form -->
			<div class="col-lg-4">
				<div class="card border-0 shadow-lg rounded-4 overflow-hidden sticky-top" style="top: 20px;">

					<!-- Card Header with Gradient -->
					<div class="card-header text-white py-4 border-0"
						 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
						<h5 class="mb-0 fw-bold text-center">
							<i class="fas fa-plus-circle me-2"></i>Add New Category
						</h5>
					</div>

					<div class="card-body p-4">

						<!-- Success/Error Messages -->
						<th:block th:if="${session.succMsg}">
							<div class="alert alert-success alert-dismissible fade show border-0 shadow-sm rounded-3 mb-3" role="alert">
								<div class="d-flex align-items-start">
									<i class="fas fa-check-circle fs-5 me-2 mt-1"></i>
									<div class="flex-grow-1">
										<strong>Success!</strong>
										<p class="mb-0 small">[[${session.succMsg}]]</p>
									</div>
								</div>
								<button type="button" class="btn-close btn-close-sm" data-bs-dismiss="alert" aria-label="Close"></button>
								<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
							</div>
						</th:block>

						<th:block th:if="${session.errorMsg}">
							<div class="alert alert-danger alert-dismissible fade show border-0 shadow-sm rounded-3 mb-3" role="alert">
								<div class="d-flex align-items-start">
									<i class="fas fa-exclamation-circle fs-5 me-2 mt-1"></i>
									<div class="flex-grow-1">
										<strong>Error!</strong>
										<p class="mb-0 small">[[${session.errorMsg}]]</p>
									</div>
								</div>
								<button type="button" class="btn-close btn-close-sm" data-bs-dismiss="alert" aria-label="Close"></button>
								<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
							</div>
						</th:block>

						<!-- Category Form -->
						<form action="/admin/saveCategory" method="post" enctype="multipart/form-data">

							<!-- Category Name -->
							<div class="mb-4">
								<label class="form-label fw-semibold text-muted">
									<i class="fas fa-tag text-primary me-2"></i>Category Name
								</label>
								<input type="text"
									   name="name"
									   class="form-control form-control-lg rounded-3 border-2"
									   placeholder="Enter category name"
									   required>
							</div>

							<!-- Status -->
							<div class="mb-4">
								<label class="form-label fw-semibold text-muted d-block mb-3">
									<i class="fas fa-toggle-on text-success me-2"></i>Status
								</label>
								<div class="d-flex flex-column gap-3">
									<div class="form-check form-check-lg">
										<input class="form-check-input"
											   type="radio"
											   checked
											   value="true"
											   name="isActive"
											   id="statusActive">
										<label class="form-check-label fw-semibold" for="statusActive">
												<span class="badge bg-success bg-gradient px-3 py-2">
													<i class="fas fa-check-circle me-1"></i>Active
												</span>
										</label>
									</div>
									<div class="form-check form-check-lg">
										<input class="form-check-input"
											   type="radio"
											   name="isActive"
											   value="false"
											   id="statusInactive">
										<label class="form-check-label fw-semibold" for="statusInactive">
												<span class="badge bg-secondary bg-gradient px-3 py-2">
													<i class="fas fa-times-circle me-1"></i>Inactive
												</span>
										</label>
									</div>
								</div>
							</div>

							<!-- Image Upload -->
							<div class="mb-4">
								<label class="form-label fw-semibold text-muted">
									<i class="fas fa-image text-info me-2"></i>Category Image
								</label>
								<input type="file"
									   name="file"
									   class="form-control form-control-lg rounded-3 border-2"
									   accept="image/*"
									   id="categoryImageInput"
									   required>
								<small class="text-muted">
									<i class="fas fa-info-circle me-1"></i>Recommended: 300x300px, Max 2MB
								</small>
							</div>

							<!-- Image Preview -->
							<div class="mb-4" id="imagePreviewContainer" style="display: none;">
								<label class="form-label fw-semibold text-muted d-block mb-2">
									<i class="fas fa-eye text-info me-2"></i>Preview
								</label>
								<div class="text-center p-3 bg-light rounded-3 border border-2 border-dashed">
									<img id="imagePreview"
										 class="rounded-3 shadow-sm"
										 style="max-width: 100%; max-height: 200px; object-fit: cover;"
										 alt="Preview">
								</div>
							</div>

							<!-- Submit Button -->
							<button type="submit" class="btn btn-primary btn-lg w-100 rounded-3 shadow-sm mt-2">
								<i class="fas fa-save me-2"></i>Save Category
							</button>

						</form>

					</div>
				</div>
			</div>

			<!-- Category List -->
			<div class="col-lg-8">
				<div class="card border-0 shadow-lg rounded-4 overflow-hidden">

					<!-- Card Header -->
					<div class="card-header text-white py-4 border-0"
						 style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
						<div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
							<div>
								<h5 class="mb-0 fw-bold">
									<i class="fas fa-list-ul me-2"></i>All Categories
								</h5>
							</div>
							<div>
									<span class="badge bg-white text-danger px-3 py-2 fs-6">
										Total: <span th:text="${totalElements}">0</span> Categories
									</span>
							</div>
						</div>
					</div>

					<!-- Table Section -->
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
								<tr>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-hashtag me-2"></i>Sl No
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-image me-2"></i>Image
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-tag me-2"></i>Category
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted text-center">
										<i class="fas fa-toggle-on me-2"></i>Status
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted text-center">
										<i class="fas fa-cog me-2"></i>Action
									</th>
								</tr>
								</thead>
								<tbody>
								<tr th:each="cat,c:${categorys}" class="border-bottom">
									<th scope="row" class="py-3 px-4 fw-semibold text-primary">
										[[${c.count}]]
									</th>
									<td class="py-3 px-4">
										<img th:src="@{'/img/category_img/'+${cat.imageName}}"
											 class="rounded-3 shadow-sm border border-2 border-white object-fit-cover"
											 width="70"
											 height="70"
											 alt="Category Image"
											 style="object-fit: cover;">
									</td>
									<td class="py-3 px-4">
										<div class="fw-semibold text-dark fs-6">
											[[${cat.name}]]
										</div>
									</td>
									<td class="py-3 px-4 text-center">
												<span th:if="${cat.isActive}"
													  class="badge bg-success bg-gradient px-3 py-2 rounded-pill">
													<i class="fas fa-check-circle me-1"></i>Active
												</span>
										<span th:unless="${cat.isActive}"
											  class="badge bg-secondary bg-gradient px-3 py-2 rounded-pill">
													<i class="fas fa-times-circle me-1"></i>Inactive
												</span>
									</td>
									<td class="py-3 px-4 text-center">
										<div class="btn-group shadow-sm" role="group">
											<a th:href="@{'/admin/loadEditCategory/'+${cat.id}}"
											   class="btn btn-sm btn-primary rounded-start"
											   data-bs-toggle="tooltip"
											   title="Edit Category">
												<i class="fas fa-edit"></i>
											</a>
											<a th:href="@{'/admin/deleteCategory/'+${cat.id}}"
											   class="btn btn-sm btn-danger rounded-end"
											   data-bs-toggle="tooltip"
											   title="Delete Category"
											   onclick="return confirm('Are you sure you want to delete this category?')">
												<i class="fas fa-trash"></i>
											</a>
										</div>
									</td>
								</tr>

								<!-- Empty State -->
								<tr th:if="${categorys.isEmpty()}">
									<td colspan="5" class="text-center py-5">
										<div class="py-5">
											<i class="fas fa-layer-group text-muted mb-3" style="font-size: 4rem; opacity: 0.3;"></i>
											<h5 class="text-muted">No Categories Found</h5>
											<p class="text-muted mb-0">Create your first category using the form on the left.</p>
										</div>
									</td>
								</tr>
								</tbody>
							</table>
						</div>
					</div>

					<!-- Pagination Footer -->
					<div class="card-footer bg-light border-0 py-4">
						<div class="row align-items-center g-3">
							<div class="col-md-4">
								<div class="d-flex align-items-center gap-2">
									<i class="fas fa-info-circle text-danger"></i>
									<span class="text-muted">
											Showing <span class="fw-bold text-dark" th:text="${categorys.size()}">0</span>
											of <span class="fw-bold text-dark" th:text="${totalElements}">0</span> categories
										</span>
								</div>
							</div>
							<div class="col-md-8">
								<nav aria-label="Category pagination">
									<ul class="pagination pagination-lg justify-content-end mb-0">
										<li class="page-item" th:classappend="${isFirst} ? 'disabled':''">
											<a class="page-link rounded-start-3"
											   th:href="@{'/admin/category?pageNo='+${pageNo-1}}"
											   aria-label="Previous">
												<i class="fas fa-chevron-left"></i>
												<span class="d-none d-md-inline ms-2">Previous</span>
											</a>
										</li>

										<li th:each="i:${#numbers.sequence(1,totalPages)}"
											class="page-item"
											th:classappend="${pageNo+1==i}?'active':''">
											<a class="page-link"
											   th:href="@{'/admin/category?pageNo='+${i-1}}">[[${i}]]</a>
										</li>

										<li class="page-item" th:classappend="${isLast} ? 'disabled':''">
											<a class="page-link rounded-end-3"
											   th:href="@{'/admin/category?pageNo='+${pageNo+1}}"
											   aria-label="Next">
												<span class="d-none d-md-inline me-2">Next</span>
												<i class="fas fa-chevron-right"></i>
											</a>
										</li>
									</ul>
								</nav>
							</div>
						</div>
					</div>

				</div>
			</div>

		</div>

	</div>

	<!-- Custom Styles -->
	<style>
		.form-control:focus,
        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .table tbody tr {
            transition: all 0.3s ease;
        }

        .table tbody tr:hover {
            background-color: #fff5f8;
            transform: scale(1.005);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .btn-group .btn {
            transition: all 0.3s ease;
        }

        .btn-group .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .rounded-4 {
            border-radius: 1rem !important;
        }

        .pagination .page-link {
            border: none;
            margin: 0 3px;
            border-radius: 8px;
            padding: 10px 16px;
            transition: all 0.3s ease;
        }

        .pagination .page-item.active .page-link {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 8px rgba(245, 87, 108, 0.3);
        }

        .pagination .page-link:hover:not(.active) {
            background-color: #fff5f8;
            transform: translateY(-2px);
        }

        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }

        .form-check-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
        }

        .form-check-lg .form-check-input {
            width: 1.5em;
            height: 1.5em;
            margin-top: 0.125em;
            cursor: pointer;
        }

        .form-check-lg .form-check-label {
            cursor: pointer;
            user-select: none;
        }

        .border-dashed {
            border-style: dashed !important;
        }

        .sticky-top {
            position: sticky;
            z-index: 1020;
        }

        @media (max-width: 992px) {
            .sticky-top {
                position: relative;
            }
        }

        @media (max-width: 768px) {
            .table {
                font-size: 0.875rem;
            }

            .btn-sm {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }
        }
	</style>

	<!-- Image Preview Script -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Image preview functionality
            const imageInput = document.getElementById('categoryImageInput');
            const imagePreview = document.getElementById('imagePreview');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');

            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        imagePreview.src = event.target.result;
                        imagePreviewContainer.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreviewContainer.style.display = 'none';
                }
            });
        });
	</script>

</section>
</body>
</html>