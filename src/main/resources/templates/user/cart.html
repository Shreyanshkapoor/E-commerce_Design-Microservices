<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>Shopping Cart</title>
</head>
<body>
<section>
	<div class="container-fluid mt-4 px-3 px-md-5 py-4">

		<!-- Page Header -->
		<div class="row mb-4">
			<div class="col-12">
				<div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
					<div>
						<h2 class="fw-bold mb-2">
							<i class="fas fa-shopping-cart text-primary me-2"></i>Shopping Cart
						</h2>
						<p class="text-muted mb-0">Review your items and proceed to checkout</p>
					</div>
					<div>
						<a href="/products" class="btn btn-outline-primary rounded-pill px-4">
							<i class="fas fa-arrow-left me-2"></i>Continue Shopping
						</a>
					</div>
				</div>
			</div>
		</div>

		<div class="row g-4">

			<!-- Cart Items Section -->
			<div class="col-lg-8">
				<div class="card border-0 shadow-lg rounded-4 overflow-hidden">

					<!-- Card Header with Gradient -->
					<div class="card-header text-white py-4 border-0"
						 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
						<div class="d-flex align-items-center justify-content-between">
							<h5 class="mb-0 fw-bold">
								<i class="fas fa-shopping-bag me-2"></i>Cart Items
							</h5>
							<span class="badge bg-white text-primary px-3 py-2 fs-6">
                                    <span th:text="${carts.size()}">0</span> Items
                                </span>
						</div>
					</div>

					<div class="card-body p-0">

						<!-- Success/Error Messages -->
						<th:block th:if="${session.succMsg}">
							<div class="alert alert-success alert-dismissible fade show border-0 m-4 mb-0 rounded-3" role="alert">
								<div class="d-flex align-items-center">
									<i class="fas fa-check-circle fs-5 me-3"></i>
									<div>
										<strong>Success!</strong>
										<p class="mb-0">[[${session.succMsg}]]</p>
									</div>
								</div>
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
								<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
							</div>
						</th:block>

						<th:block th:if="${session.errorMsg}">
							<div class="alert alert-danger alert-dismissible fade show border-0 m-4 mb-0 rounded-3" role="alert">
								<div class="d-flex align-items-center">
									<i class="fas fa-exclamation-circle fs-5 me-3"></i>
									<div>
										<strong>Error!</strong>
										<p class="mb-0">[[${session.errorMsg}]]</p>
									</div>
								</div>
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
								<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
							</div>
						</th:block>

						<!-- Cart Items List -->
						<div class="cart-items-container">
							<th:block th:each="cart,c:${carts}">
								<div class="cart-item">
									<div class="row g-3 align-items-center">

										<!-- Serial Number -->
										<div class="col-auto d-none d-md-block">
											<div class="item-number">
												[[${c.count}]]
											</div>
										</div>

										<!-- Product Image -->
										<div class="col-auto">
											<div class="product-image-wrapper">
												<img th:src="@{'/img/product_img/'+${cart.product.image}}"
													 class="product-image"
													 alt="Product Image">
											</div>
										</div>

										<!-- Product Details -->
										<div class="col">
											<h6 class="fw-bold mb-2 text-dark">
												[[${cart.product.title}]]
											</h6>
											<div class="d-flex flex-wrap gap-3 align-items-center">
												<div class="price-info">
													<span class="text-muted small">Unit Price:</span>
													<span class="fw-bold text-primary ms-1">
                                                            ₹[[${cart.product.discountPrice}]]
                                                        </span>
												</div>
											</div>
										</div>

										<!-- Quantity Controls -->
										<div class="col-auto">
											<div class="quantity-control">
												<a th:href="@{'/user/cartQuantityUpdate?sy=de&cid='+${cart.id}}"
												   class="qty-btn qty-decrease"
												   data-bs-toggle="tooltip"
												   title="Decrease quantity">
													<i class="fas fa-minus"></i>
												</a>
												<span class="qty-display">
                                                        [[${cart.quantity}]]
                                                    </span>
												<a th:href="@{'/user/cartQuantityUpdate?sy=in&cid='+${cart.id}}"
												   class="qty-btn qty-increase"
												   data-bs-toggle="tooltip"
												   title="Increase quantity">
													<i class="fas fa-plus"></i>
												</a>
											</div>
										</div>

										<!-- Total Price -->
										<div class="col-auto">
											<div class="text-end">
												<div class="text-muted small mb-1">Total</div>
												<div class="fw-bold text-success fs-5">
													₹[[${cart.totalPrice}]]
												</div>
											</div>
										</div>

									</div>
								</div>
							</th:block>

							<!-- Empty Cart State -->
							<th:block th:if="${carts.isEmpty()}">
								<div class="empty-cart">
									<i class="fas fa-shopping-cart"></i>
									<h5 class="mt-3 mb-2">Your cart is empty</h5>
									<p class="text-muted mb-4">Add some products to get started!</p>
									<a href="/products" class="btn btn-primary rounded-pill px-4">
										<i class="fas fa-shopping-bag me-2"></i>Browse Products
									</a>
								</div>
							</th:block>
						</div>

					</div>
				</div>
			</div>

			<!-- Order Summary Section -->
			<div class="col-lg-4">
				<div class="card border-0 shadow-lg rounded-4 overflow-hidden sticky-top" style="top: 20px;">

					<!-- Card Header -->
					<div class="card-header text-white py-4 border-0"
						 style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
						<h5 class="mb-0 fw-bold">
							<i class="fas fa-receipt me-2"></i>Order Summary
						</h5>
					</div>

					<div class="card-body p-4">

						<!-- Summary Details -->
						<div class="summary-details">
							<div class="summary-row">
                                    <span class="summary-label">
                                        <i class="fas fa-box text-primary me-2"></i>Subtotal
                                    </span>
								<span class="summary-value">
                                        <th:block th:utext="${@commnServiceImpl.rupeeSign()}"></th:block>[[${totalOrderPrice}]]
                                    </span>
							</div>

							<div class="summary-row">
                                    <span class="summary-label">
                                        <i class="fas fa-truck text-success me-2"></i>Shipping
                                    </span>
								<span class="summary-value text-success">
                                        Free
                                    </span>
							</div>

							<div class="summary-row">
                                    <span class="summary-label">
                                        <i class="fas fa-percentage text-warning me-2"></i>Discount
                                    </span>
								<span class="summary-value text-success">
                                        <th:block th:utext="${@commnServiceImpl.rupeeSign()}"></th:block>0
                                    </span>
							</div>

							<div class="summary-divider"></div>

							<div class="summary-row summary-total">
                                    <span class="summary-label">
                                        <i class="fas fa-coins text-success me-2"></i>Total Amount
                                    </span>
								<span class="summary-value">
                                        <th:block th:utext="${@commnServiceImpl.rupeeSign()}"></th:block>[[${totalOrderPrice}]]
                                    </span>
							</div>
						</div>

						<!-- Proceed Button -->
						<div class="mt-4" th:if="${!carts.isEmpty()}">
							<a href="/user/orders" class="btn btn-primary btn-lg w-100 rounded-3 shadow-sm">
								<i class="fas fa-lock me-2"></i>Proceed to Checkout
							</a>
						</div>

						<!-- Security Badge -->
						<div class="alert alert-light border rounded-3 mt-3 mb-0">
							<div class="d-flex align-items-start">
								<i class="fas fa-shield-alt text-success fs-5 me-2 mt-1"></i>
								<div>
									<small class="text-muted">
										<strong>Secure Checkout:</strong> Your payment information is encrypted and secure
									</small>
								</div>
							</div>
						</div>

					</div>
				</div>

				<!-- Benefits Card -->
				<div class="card border-0 shadow-sm rounded-3 mt-4" th:if="${!carts.isEmpty()}">
					<div class="card-body p-4">
						<h6 class="fw-bold mb-3">
							<i class="fas fa-gift text-primary me-2"></i>Shopping Benefits
						</h6>
						<ul class="benefits-list">
							<li>
								<i class="fas fa-check-circle text-success me-2"></i>
								Free delivery on all orders
							</li>
							<li>
								<i class="fas fa-check-circle text-success me-2"></i>
								7-day easy return policy
							</li>
							<li>
								<i class="fas fa-check-circle text-success me-2"></i>
								Secure payment gateway
							</li>
							<li>
								<i class="fas fa-check-circle text-success me-2"></i>
								24/7 customer support
							</li>
						</ul>
					</div>
				</div>
			</div>

		</div>

	</div>

	<!-- Custom Styles -->
	<style>
		/* Cart Items */
        .cart-items-container {
            max-height: 600px;
            overflow-y: auto;
        }

        .cart-item {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            background-color: #f8f9ff;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .item-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .product-image-wrapper {
            width: 100px;
            height: 100px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-image-wrapper:hover .product-image {
            transform: scale(1.1);
        }

        /* Quantity Controls */
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .qty-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            transform: scale(1.1);
        }

        .qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: #1a1a1a;
        }

        /* Summary Section */
        .summary-details {
            padding: 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
        }

        .summary-label {
            color: #6c757d;
            font-size: 0.95rem;
        }

        .summary-value {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 1rem;
        }

        .summary-total {
            padding: 1rem 0;
        }

        .summary-total .summary-label {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a1a;
        }

        .summary-total .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #28a745;
        }

        .summary-divider {
            height: 2px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            margin: 0.5rem 0;
        }

        /* Benefits List */
        .benefits-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .benefits-list li {
            padding: 0.5rem 0;
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* Empty Cart */
        .empty-cart {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-cart i {
            font-size: 5rem;
            color: #dee2e6;
            margin-bottom: 1rem;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-outline-primary {
            border: 2px solid #667eea;
            color: #667eea;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: white;
            transform: translateY(-2px);
        }

        .rounded-4 {
            border-radius: 1rem !important;
        }

        .sticky-top {
            position: sticky;
            z-index: 1020;
        }

        @media (max-width: 992px) {
            .sticky-top {
                position: relative;
            }

            .product-image-wrapper {
                width: 80px;
                height: 80px;
            }

            .qty-display {
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .cart-item {
                padding: 1rem;
            }

            .product-image-wrapper {
                width: 70px;
                height: 70px;
            }

            .quantity-control {
                flex-direction: column;
            }
        }
	</style>

	<!-- Initialize Tooltips -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Auto-hide alerts
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            });
        });
	</script>

</section>
</body>
</html>