<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>My Orders</title>
</head>
<body>
<section>
	<div class="container-fluid mt-4 px-3 px-md-5 py-4">

		<!-- Page Header -->
		<div class="row mb-4">
			<div class="col-12">
				<div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
					<div>
						<h2 class="fw-bold mb-2">
							<i class="fas fa-shopping-bag text-primary me-2"></i>My Orders
						</h2>
						<p class="text-muted mb-0">Track and manage your orders</p>
					</div>
					<div>
						<a href="/" class="btn btn-outline-primary rounded-pill px-4">
							<i class="fas fa-shopping-cart me-2"></i>Continue Shopping
						</a>
					</div>
				</div>
			</div>
		</div>

		<!-- Success/Error Messages -->
		<div class="row">
			<div class="col-12">
				<th:block th:if="${session.succMsg}">
					<div class="alert alert-success alert-dismissible fade show border-0 shadow-sm rounded-3 mb-4" role="alert">
						<div class="d-flex align-items-center">
							<i class="fas fa-check-circle fs-4 me-3"></i>
							<div>
								<strong>Success!</strong>
								<p class="mb-0">[[${session.succMsg}]]</p>
							</div>
						</div>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
					</div>
				</th:block>

				<th:block th:if="${session.errorMsg}">
					<div class="alert alert-danger alert-dismissible fade show border-0 shadow-sm rounded-3 mb-4" role="alert">
						<div class="d-flex align-items-center">
							<i class="fas fa-exclamation-circle fs-4 me-3"></i>
							<div>
								<strong>Error!</strong>
								<p class="mb-0">[[${session.errorMsg}]]</p>
							</div>
						</div>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
					</div>
				</th:block>
			</div>
		</div>

		<!-- Orders Table Card -->
		<div class="row">
			<div class="col-12">
				<div class="card border-0 shadow-lg rounded-4 overflow-hidden">

					<!-- Card Header -->
					<div class="card-header text-white py-4 border-0"
						 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
						<div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
							<div>
								<h5 class="mb-0 fw-bold">
									<i class="fas fa-list-ul me-2"></i>Order History
								</h5>
							</div>
							<div>
                                    <span class="badge bg-white text-primary px-3 py-2 fs-6">
                                        Total: <span th:text="${orders.size()}">0</span> Orders
                                    </span>
							</div>
						</div>
					</div>

					<!-- Table Section -->
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
								<tr>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-hashtag me-2"></i>Order ID
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-calendar me-2"></i>Order Date
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-box me-2"></i>Product
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted">
										<i class="fas fa-rupee-sign me-2"></i>Price Details
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted text-center">
										<i class="fas fa-info-circle me-2"></i>Status
									</th>
									<th scope="col" class="py-3 px-4 fw-semibold text-muted text-center">
										<i class="fas fa-cog me-2"></i>Action
									</th>
								</tr>
								</thead>
								<tbody>
								<tr th:each="o:${orders}" class="border-bottom order-row">
									<!-- Order ID -->
									<th scope="row" class="py-4 px-4">
                                                <span class="badge bg-primary bg-gradient px-3 py-2 fs-6">
                                                    [[${o.orderId}]]
                                                </span>
									</th>

									<!-- Order Date -->
									<td class="py-4 px-4">
										<div class="text-muted">
											<i class="fas fa-calendar-alt text-info me-2"></i>
											[[${o.orderDate}]]
										</div>
									</td>

									<!-- Product Details -->
									<td class="py-4 px-4">
										<div class="product-info">
											<div class="fw-semibold text-dark mb-1">
												[[${o.product.title}]]
											</div>
										</div>
									</td>

									<!-- Price Details -->
									<td class="py-4 px-4">
										<div class="price-details">
											<div class="mb-1">
                                                        <span class="badge bg-light text-dark border px-2 py-1">
                                                            <i class="fas fa-cubes me-1"></i>Qty: [[${o.quantity}]]
                                                        </span>
											</div>
											<div class="mb-1 text-muted small">
												Unit Price: ₹[[${o.price}]]
											</div>
											<div class="fw-bold text-success fs-6">
												Total: ₹[[${o.quantity * o.price}]]
											</div>
										</div>
									</td>

									<!-- Status -->
									<td class="py-4 px-4 text-center">
                                                <span th:if="${o.status == 'In Progress'}"
													  class="badge bg-info bg-gradient px-3 py-2 rounded-pill">
                                                    <i class="fas fa-spinner me-1"></i>[[${o.status}]]
                                                </span>
										<span th:if="${o.status == 'Order Received'}"
											  class="badge bg-primary bg-gradient px-3 py-2 rounded-pill">
                                                    <i class="fas fa-check me-1"></i>[[${o.status}]]
                                                </span>
										<span th:if="${o.status == 'Product Packed'}"
											  class="badge bg-warning bg-gradient px-3 py-2 rounded-pill">
                                                    <i class="fas fa-box me-1"></i>[[${o.status}]]
                                                </span>
										<span th:if="${o.status == 'Out for Delivery'}"
											  class="badge bg-secondary bg-gradient px-3 py-2 rounded-pill">
                                                    <i class="fas fa-truck me-1"></i>[[${o.status}]]
                                                </span>
										<span th:if="${o.status == 'Delivered'}"
											  class="badge bg-success bg-gradient px-3 py-2 rounded-pill">
                                                    <i class="fas fa-check-circle me-1"></i>[[${o.status}]]
                                                </span>
										<span th:if="${o.status == 'Cancelled'}"
											  class="badge bg-danger bg-gradient px-3 py-2 rounded-pill">
                                                    <i class="fas fa-times-circle me-1"></i>[[${o.status}]]
                                                </span>
									</td>

									<!-- Action -->
									<td class="py-4 px-4 text-center">
										<th:block th:if="${o.status != 'Cancelled' && o.status != 'Delivered'}">
											<a th:href="@{'/user/update-status?id='+${o.id}+'&st=6'}"
											   class="btn btn-sm btn-danger rounded-3 shadow-sm"
											   onclick="return confirm('Are you sure you want to cancel this order?')">
												<i class="fas fa-times-circle me-1"></i>Cancel Order
											</a>
										</th:block>
										<th:block th:if="${o.status == 'Cancelled'}">
											<button class="btn btn-sm btn-secondary rounded-3 disabled" disabled>
												<i class="fas fa-ban me-1"></i>Cancelled
											</button>
										</th:block>
										<th:block th:if="${o.status == 'Delivered'}">
											<button class="btn btn-sm btn-success rounded-3 disabled" disabled>
												<i class="fas fa-check me-1"></i>Delivered
											</button>
										</th:block>
									</td>
								</tr>

								<!-- Empty State -->
								<tr th:if="${orders.isEmpty()}">
									<td colspan="6" class="text-center py-5">
										<div class="py-5">
											<i class="fas fa-shopping-bag text-muted mb-3" style="font-size: 4rem; opacity: 0.3;"></i>
											<h5 class="text-muted">No Orders Yet</h5>
											<p class="text-muted mb-4">You haven't placed any orders yet.</p>
											<a href="/" class="btn btn-primary rounded-pill px-4">
												<i class="fas fa-shopping-cart me-2"></i>Start Shopping
											</a>
										</div>
									</td>
								</tr>
								</tbody>
							</table>
						</div>
					</div>

					<!-- Card Footer -->
					<div class="card-footer bg-light border-0 py-3" th:if="${!orders.isEmpty()}">
						<div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
							<div class="text-muted small">
								<i class="fas fa-info-circle me-1"></i>
								Showing <span class="fw-bold text-dark" th:text="${orders.size()}">0</span> orders
							</div>
							<div>
								<a href="#" class="btn btn-sm btn-outline-primary rounded-pill">
									<i class="fas fa-download me-1"></i> Download Invoice
								</a>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>

		<!-- Order Tracking Info -->
		<div class="row mt-4" th:if="${!orders.isEmpty()}">
			<div class="col-12">
				<div class="card border-0 shadow-sm rounded-3">
					<div class="card-body p-4">
						<h6 class="fw-bold mb-3">
							<i class="fas fa-truck text-primary me-2"></i>Order Status Guide
						</h6>
						<div class="row g-3">
							<div class="col-md-4">
								<div class="d-flex align-items-center gap-2">
                                        <span class="badge bg-info px-2 py-1">
                                            <i class="fas fa-spinner"></i>
                                        </span>
									<small class="text-muted">In Progress - Order is being processed</small>
								</div>
							</div>
							<div class="col-md-4">
								<div class="d-flex align-items-center gap-2">
                                        <span class="badge bg-warning px-2 py-1">
                                            <i class="fas fa-box"></i>
                                        </span>
									<small class="text-muted">Product Packed - Ready for dispatch</small>
								</div>
							</div>
							<div class="col-md-4">
								<div class="d-flex align-items-center gap-2">
                                        <span class="badge bg-success px-2 py-1">
                                            <i class="fas fa-check-circle"></i>
                                        </span>
									<small class="text-muted">Delivered - Order completed</small>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>

	<!-- Custom Styles -->
	<style>
		.table tbody tr.order-row {
            transition: all 0.3s ease;
        }

        .table tbody tr.order-row:hover {
            background-color: #f8f9ff;
            transform: scale(1.005);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .product-info {
            max-width: 250px;
        }

        .price-details {
            min-width: 150px;
        }

        .rounded-4 {
            border-radius: 1rem !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-outline-primary {
            border: 2px solid #667eea;
            color: #667eea;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: white;
            transform: translateY(-2px);
        }

        .btn-danger {
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        @media (max-width: 768px) {
            .table {
                font-size: 0.875rem;
            }

            .btn-sm {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }

            .product-info {
                max-width: 150px;
            }
        }
	</style>

	<!-- Cancel Confirmation Script -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
            // Auto-hide alerts after 5 seconds
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            });
        });
	</script>

</section>
</body>
</html>